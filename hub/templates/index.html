<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Hub — Marc Byers</title>
    <style>
        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --surface2: #1c2333;
            --border: #30363d;
            --text: #e6edf3;
            --text-dim: #8b949e;
            --accent: #58a6ff;
            --green: #3fb950;
            --yellow: #d29922;
            --red: #f85149;
            --purple: #bc8cff;
            --orange: #f0883e;
            --pink: #f778ba;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.5;
        }

        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .header h1 span { color: var(--accent); }

        .header .meta {
            color: var(--text-dim);
            font-size: 13px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.2s, transform 0.2s;
        }

        .dashboard-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .card-top {
            padding: 20px 24px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .card-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .card-info .desc {
            color: var(--text-dim);
            font-size: 13px;
        }

        .status-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-dot.online { background: var(--green); box-shadow: 0 0 6px rgba(63,185,80,0.5); }
        .status-dot.offline { background: var(--red); box-shadow: 0 0 6px rgba(248,81,73,0.5); }

        .status-text {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .status-text.online { color: var(--green); }
        .status-text.offline { color: var(--red); }

        .card-stats {
            padding: 12px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 24px;
            font-size: 13px;
        }

        .card-stats .stat {
            display: flex;
            flex-direction: column;
        }

        .card-stats .stat-label {
            color: var(--text-dim);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .card-stats .stat-value {
            font-weight: 700;
            font-family: 'SF Mono', 'Fira Code', monospace;
        }

        .card-actions {
            padding: 12px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.15s;
        }

        .btn-primary {
            background: var(--accent);
            color: #000;
            border-color: var(--accent);
        }

        .btn-primary:hover { background: #79b8ff; text-decoration: none; }

        .btn-ghost {
            background: transparent;
            color: var(--text-dim);
        }

        .btn-ghost:hover { color: var(--text); border-color: var(--text-dim); text-decoration: none; }

        /* Agent Status Grid */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 40px;
        }

        .agent-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px 20px;
        }

        .agent-card .agent-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .agent-card .agent-icon {
            font-size: 20px;
        }

        .agent-card .agent-name {
            font-weight: 600;
            font-size: 14px;
        }

        .agent-card .agent-meta {
            font-size: 12px;
            color: var(--text-dim);
        }

        .agent-card .agent-meta span {
            display: block;
            margin-top: 2px;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-green { background: rgba(63,185,80,.15); color: var(--green); }
        .badge-red { background: rgba(248,81,73,.15); color: var(--red); }
        .badge-yellow { background: rgba(210,153,34,.15); color: var(--yellow); }

        /* Quick Links */
        .quick-links {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .quick-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-dim);
            text-decoration: none;
            transition: all 0.15s;
        }

        .quick-link:hover {
            border-color: var(--accent);
            color: var(--text);
            text-decoration: none;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 24px;
            color: var(--text-dim);
            font-size: 12px;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .agent-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>&#9881;</span> Agent Hub</h1>
        <div class="meta">Last refreshed: {{ now }}</div>
    </div>

    <div class="container">
        <!-- Dashboards -->
        <div class="section-title">
            <span class="dot" style="background: var(--accent);"></span>
            Web Dashboards
        </div>

        <div class="dashboard-grid">
            {% for d in dashboards %}
            <div class="dashboard-card">
                <div class="card-top">
                    <div class="card-icon" style="background: {{ d.color }}22; color: {{ d.color }};">
                        {{ d.icon|safe }}
                    </div>
                    <div class="card-info">
                        <h3>{{ d.name }}</h3>
                        <div class="desc">{{ d.description }}</div>
                        <div class="status-row">
                            <div class="status-dot {{ 'online' if d.healthy else 'offline' }}"></div>
                            <span class="status-text {{ 'online' if d.healthy else 'offline' }}">
                                {{ 'Online' if d.healthy else 'Offline' }}
                            </span>
                            <span style="color: var(--text-dim); font-size: 12px;">
                                — port {{ d.port }}
                            </span>
                        </div>
                    </div>
                </div>

                {% if d.db_stats %}
                <div class="card-stats">
                    <div class="stat">
                        <span class="stat-label">Tables</span>
                        <span class="stat-value">{{ d.db_stats.tables }}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Records</span>
                        <span class="stat-value">{{ "{:,}".format(d.db_stats.rows) }}</span>
                    </div>
                    {% if d.latest_report %}
                    <div class="stat">
                        <span class="stat-label">Last Report</span>
                        <span class="stat-value" style="font-size: 12px;">{{ d.latest_report.modified }}</span>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <div class="card-actions">
                    {% if d.healthy %}
                    <a href="{{ d.url }}" target="_blank" class="btn btn-primary">Open Dashboard</a>
                    {% else %}
                    <span class="btn btn-ghost" style="cursor: default;">Dashboard Offline</span>
                    {% endif %}
                    <a href="{{ d.url }}/api/{{ 'songs' if 'Song' in d.name else ('deals' if 'Deal' in d.name else 'status') }}" target="_blank" class="btn btn-ghost">API</a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Background Agents -->
        <div class="section-title">
            <span class="dot" style="background: var(--orange);"></span>
            Background Agents
        </div>

        <div class="agent-grid">
            {% for a in agents %}
            <div class="agent-card">
                <div class="agent-header">
                    <span class="agent-icon">{{ a.icon|safe }}</span>
                    <span class="agent-name">{{ a.name }}</span>
                    {% if a.pid %}
                    <span class="badge badge-green">PID {{ a.pid }}</span>
                    {% else %}
                    <span class="badge badge-yellow">Idle</span>
                    {% endif %}
                </div>
                <div class="agent-meta">
                    {% if a.db_stats %}
                    <span>{{ "{:,}".format(a.db_stats.rows) }} records across {{ a.db_stats.tables }} tables</span>
                    {% endif %}
                    {% if a.latest_report %}
                    <span>Latest report: {{ a.latest_report.modified }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Quick Links -->
        <div class="section-title">
            <span class="dot" style="background: var(--green);"></span>
            Quick Links
        </div>

        <div class="quick-links">
            <a href="http://localhost:5555" target="_blank" class="quick-link">&#9835; Song Catalog</a>
            <a href="http://localhost:5555/splits" target="_blank" class="quick-link">&#128221; Rights & Splits</a>
            <a href="http://localhost:5555/imports" target="_blank" class="quick-link">&#128228; Import Data</a>
            <a href="http://localhost:5555/analytics" target="_blank" class="quick-link">&#128200; Song Analytics</a>
            <a href="http://localhost:5556" target="_blank" class="quick-link">&#128188; Deal Pipeline</a>
            <a href="http://localhost:5556/gaps" target="_blank" class="quick-link">&#128270; Gap Analysis</a>
            <a href="http://localhost:5557" target="_blank" class="quick-link">&#9993; Email Overview</a>
            <a href="http://localhost:5557/follow-ups" target="_blank" class="quick-link">&#128276; Follow-ups</a>
            <a href="http://localhost:5557/drafts" target="_blank" class="quick-link">&#128394; Draft Responses</a>
            <a href="http://localhost:5557/contacts" target="_blank" class="quick-link">&#128101; Contacts</a>
        </div>
    </div>

    <div class="footer">
        Agent Hub &mdash; Marc Byers &mdash; {{ now }}
    </div>

    <script>
    // Auto-refresh status every 30 seconds
    setInterval(async () => {
        try {
            const resp = await fetch('/api/status');
            const data = await resp.json();
            // Could update status dots dynamically
        } catch(e) {}
    }, 30000);
    </script>
</body>
</html>
